import{r as t,j as e}from"./index-BHzTjgdo.js";import{B as s,u as i,l as r,E as n,a as o,S as a,e as l,c as h,m as d,b as c,f as u,d as g,i as f,g as m,h as y,j as p,k as _,n as C,G as P,o as w,p as v,q as F,r as E,s as T,t as G,v as b,w as S,x as j,y as R,z as O,P as x,A,C as M,D as N,F as k,H as L,I,J as D,K as Y,L as X,M as U,N as V,O as q,Q as K,R as z,T as H,U as Z,V as W,W as $,X as J,Y as Q,Z as B,_ as tt,$ as et,a0 as st,a1 as it,a2 as rt,a3 as nt,a4 as ot,a5 as at,a6 as lt,a7 as ht,a8 as dt,a9 as ct,aa as ut,ab as gt,ac as ft,ad as mt,ae as yt,af as pt,ag as _t,ah as Ct,ai as Pt,aj as wt,ak as vt}from"./Tile-B_8rgVKG.js";const Ft="_root_1tecc_1";function Et(t,e){const s=(""+t).split("."),i=(""+e).split(".");for(let r=0;r<Math.max(s.length,i.length);r++){const t=parseInt(s[r]||"0",10),e=parseInt(i[r]||"0",10);if(t>e)return 1;if(e>t)return-1}return 0}class Tt extends s{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Tt(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const s=this.getStyle();return s&&t.setStyle(s),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(i(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=r(t,n.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if("function"==typeof t)return t;let e;if(Array.isArray(t))e=t;else{o("function"==typeof t.getZIndex,"Expected an `ol/style/Style` or an array of `ol/style/Style.js`");e=[t]}return function(){return e}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}class Gt extends a{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){l(this.flatCoordinates,t),this.changed()}clone(){const t=new Gt(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<h(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(d(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),c(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,s,i))}forEachSegment(t){return u(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(e=void 0!==e&&e,g(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return f(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return m(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return y(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=p(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Gt(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return _(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=C(this.flatCoordinates,0,t,this.stride),this.changed()}}const bt=Gt;class St extends P{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(i),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,s=t.length;e<s;++e)this.changeEventsKeys_.push(r(t[e],n.CHANGE,this.changed,this))}clone(){const t=new St(jt(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,s,i){if(i<h(this.getExtent(),t,e))return i;const r=this.geometries_;for(let n=0,o=r.length;n<o;++n)i=r[n].closestPointXY(t,e,s,i);return i}containsXY(t,e){const s=this.geometries_;for(let i=0,r=s.length;i<r;++i)if(s[i].containsXY(t,e))return!0;return!1}computeExtent(t){w(t);const e=this.geometries_;for(let s=0,i=e.length;s<i;++s)v(t,e[s].getExtent());return t}getGeometries(){return jt(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let s=0,i=e.length;s<i;++s)e[s].getType()===this.getType()?t=t.concat(e[s].getGeometriesArrayRecursive()):t.push(e[s]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],s=this.geometries_;let i=!1;for(let r=0,n=s.length;r<n;++r){const n=s[r],o=n.getSimplifiedGeometry(t);e.push(o),o!==n&&(i=!0)}if(i){return new St(e)}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let s=0,i=e.length;s<i;++s)if(e[s].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const s=this.geometries_;for(let i=0,r=s.length;i<r;++i)s[i].rotate(t,e);this.changed()}scale(t,e,s){s||(s=F(this.getExtent()));const i=this.geometries_;for(let r=0,n=i.length;r<n;++r)i[r].scale(t,e,s);this.changed()}setGeometries(t){this.setGeometriesArray(jt(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let s=0,i=e.length;s<i;++s)e[s].applyTransform(t);this.changed()}translate(t,e){const s=this.geometries_;for(let i=0,r=s.length;i<r;++i)s[i].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function jt(t){return t.map((t=>t.clone()))}const Rt=St;class Ot extends a{constructor(t,e,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&s)this.setFlatCoordinates(e,t),this.ends_=s;else{const e=t,s=[],i=[];for(let t=0,n=e.length;t<n;++t){const r=e[t];l(s,r.getFlatCoordinates()),i.push(s.length)}const r=0===e.length?this.getLayout():e[0].getLayout();this.setFlatCoordinates(r,s),this.ends_=i}}appendLineString(t){l(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ot(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<h(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(E(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),T(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,s,i))}getCoordinateAtM(t,e,s){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(e=void 0!==e&&e,s=void 0!==s&&s,G(this.flatCoordinates,0,this.ends_,this.stride,t,e,s))}getCoordinates(){return b(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new bt(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,s=this.layout,i=[];let r=0;for(let n=0,o=e.length;n<o;++n){const o=e[n],a=new bt(t.slice(r,o),s);i.push(a),r=o}return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let s=0;const i=this.ends_,r=this.stride;for(let n=0,o=i.length;n<o;++n){const o=i[n],a=m(e,s,o,r,.5);l(t,a),s=o}return t}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=S(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,s),new Ot(e,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(t){return j(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const s=R(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===s.length?0:s[s.length-1],this.changed()}}const xt=Ot;class At extends a{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){l(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new At(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){if(i<h(this.getExtent(),t,e))return i;const r=this.flatCoordinates,n=this.stride;for(let o=0,a=r.length;o<a;o+=n){const a=O(t,e,r[o],r[o+1]);if(a<i){i=a;for(let t=0;t<n;++t)s[t]=r[o+t];s.length=n}}return i}getCoordinates(){return f(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new x(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,s=this.stride,i=[];for(let r=0,n=t.length;r<n;r+=s){const n=new x(t.slice(r,r+s),e);i.push(n)}return i}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,s=this.stride;for(let i=0,r=e.length;i<r;i+=s){const s=e[i],r=e[i+1];if(A(t,s,r))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=C(this.flatCoordinates,0,t,this.stride),this.changed()}}const Mt=At;class Nt extends a{constructor(t,e,s){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!s&&!Array.isArray(t[0])){const i=t,r=[],n=[];for(let t=0,e=i.length;t<e;++t){const e=i[t],s=r.length,o=e.getEnds();for(let t=0,i=o.length;t<i;++t)o[t]+=s;l(r,e.getFlatCoordinates()),n.push(o)}e=0===i.length?this.getLayout():i[0].getLayout(),t=r,s=n}void 0!==e&&s?(this.setFlatCoordinates(e,t),this.endss_=s):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const s=this.flatCoordinates.length;l(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,i=e.length;t<i;++t)e[t]+=s}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();const s=new Nt(this.flatCoordinates.slice(),this.layout,e);return s.applyProperties(this),s}closestPointXY(t,e,s,i){return i<h(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(M(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),N(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,s,i))}containsXY(t,e){return k(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return L(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),I(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,D(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Y(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=X(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Mt(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;U(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=I(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],s=[];return e.length=V(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,s),new Nt(e,"XY",s)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const s=this.endss_[t].slice(),i=s[s.length-1];if(0!==e)for(let r=0,n=s.length;r<n;++r)s[r]-=e;return new q(this.flatCoordinates.slice(e,i),this.layout,s)}getPolygons(){const t=this.layout,e=this.flatCoordinates,s=this.endss_,i=[];let r=0;for(let n=0,o=s.length;n<o;++n){const o=s[n].slice(),a=o[o.length-1];if(0!==r)for(let t=0,e=o.length;t<e;++t)o[t]-=r;const l=new q(e.slice(r,a),t,o);i.push(l),r=a}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return K(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const s=z(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===s.length)this.flatCoordinates.length=0;else{const t=s[s.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}const kt=Nt;function Lt(t,e){const s=[];Object.keys(e).forEach((function(t){null!==e[t]&&void 0!==e[t]&&s.push(t+"="+encodeURIComponent(e[t]))}));const i=s.join("&");return t=t.replace(/[?&]$/,""),(t+=t.includes("?")?"&":"?")+i}const It="1.3.0";function Dt(t,e,s,i,r,n,o){n=Object.assign({REQUEST:"GetMap"},n);const a=e/s,l=[H(Z(t)/a,4),H(W(t)/a,4)];if(1!=s)switch(o){case"geoserver":const t=90*s+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+t:n.FORMAT_OPTIONS="dpi:"+t;break;case"mapserver":n.MAP_RESOLUTION=90*s;break;case"carmentaserver":case"qgis":n.DPI=90*s;break;default:throw new Error("Unknown `serverType` configured")}const h=function(t,e,s,i,r){r.WIDTH=s[0],r.HEIGHT=s[1];const n=i.getAxisOrientation();let o;const a=Et(r.VERSION,"1.3")>=0;return r[a?"CRS":"SRS"]=i.getCode(),o=a&&"ne"==n.substr(0,2)?[e[1],e[0],e[3],e[2]]:e,r.BBOX=o.join(","),Lt(t,r)}(r,t,l,i,n);return h}function Yt(t,e){return Object.assign({REQUEST:e,SERVICE:"WMS",VERSION:It,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},t)}class Xt extends ${constructor(t){t=t||{};const e=Object.assign({},t.params),s=!("TRANSPARENT"in e)||e.TRANSPARENT;super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!s,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=J(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,s,i){const r=Q(s),n=this.getProjection()||r;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(n));const a=B(t,r,n),l=tt(n,r,t,e),h=o.getZForResolution(l,this.zDirection),d=o.getResolution(h),c=o.getTileCoordForCoordAndZ(a,h);if(o.getResolutions().length<=c[0])return;let u=o.getTileCoordExtent(c,this.tmpExtent_);const g=this.gutter_;0!==g&&(u=et(u,d*g,u));const f={QUERY_LAYERS:this.params_.LAYERS};Object.assign(f,Yt(this.params_,"GetFeatureInfo"),i);const m=Math.floor((a[0]-u[0])/d),y=Math.floor((u[3]-a[1])/d);return f[this.v13_?"I":"X"]=m,f[this.v13_?"J":"Y"]=y,this.getRequestUrl_(c,u,1,n||r,f)}getLegendUrl(t,e){if(void 0===this.urls[0])return;const s={SERVICE:"WMS",VERSION:It,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===e||void 0===e.LAYER){const t=this.params_.LAYERS;if(!(!Array.isArray(t)||1===t.length))return;s.LAYER=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1,i=28e-5;s.SCALE=t*e/i}return Object.assign(s,e),Lt(this.urls[0],s)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,s,i,r){const n=this.urls;if(!n)return;let o;if(1==n.length)o=n[0];else{o=n[st(it(t),n.length)]}return Dt(e,(this.tileGrid||this.getTileGridForProjection(i)).getResolution(t[0]),s,i,o,r,this.serverType_)}getTilePixelRatio(t){return this.hidpi_&&void 0!==this.serverType_?t:1}getKeyForParams_(){let t=0;const e=[];for(const s in this.params_)e[t++]=s+"-"+this.params_[s];return e.join("/")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const t=this.params_.VERSION||It;this.v13_=Et(t,"1.3")>=0}tileUrlFunction(t,e,s){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(s)),i.getResolutions().length<=t[0])return;1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);const r=i.getResolution(t[0]);let n=i.getTileCoordExtent(t,this.tmpExtent_);const o=this.gutter_;0!==o&&(n=et(n,r*o,n));const a=Object.assign({},Yt(this.params_,"GetMap"));return this.getRequestUrl_(t,n,e,s,a)}}class Ut{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Tt,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let s=e.dataProjection?Q(e.dataProjection):this.readProjection(t);e.extent&&s&&"tile-pixels"===s.getUnits()&&(s=Q(s),s.setWorldExtent(e.extent)),e={dataProjection:s,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return at()}readFeature(t,e){return at()}readFeatures(t,e){return at()}readGeometry(t,e){return at()}readProjection(t){return at()}writeFeature(t,e){return at()}writeFeatures(t,e){return at()}writeGeometry(t,e){return at()}}function Vt(t,e,s){const i=s?Q(s.featureProjection):null,r=s?Q(s.dataProjection):null;let n=t;if(i&&r&&!rt(i,r)){e&&(n=t.clone());const s=e?i:r,o=e?r:i;"tile-pixels"===s.getUnits()?n.transform(s,o):n.applyTransform(nt(s,o))}if(e&&s&&void 0!==s.decimals){const e=Math.pow(10,s.decimals),i=function(t){for(let s=0,i=t.length;s<i;++s)t[s]=Math.round(t[s]*e)/e;return t};n===t&&(n=t.clone()),n.applyTransform(i)}return n}const qt={Point:x,LineString:bt,Polygon:q,MultiPoint:Mt,MultiLineString:xt,MultiPolygon:kt};function Kt(t,e){const s=t.geometry;if(!s)return[];if(Array.isArray(s))return s.map((e=>Kt({...t,geometry:e}))).flat();const i="MultiPolygon"===s.type?"Polygon":s.type;if("GeometryCollection"===i||"Circle"===i)throw new Error("Unsupported geometry type: "+i);const r=s.layout.length;return Vt(new ot(i,"Polygon"===i?function(t,e,s){return Array.isArray(e[0])?(U(t,0,e,s)||(t=t.slice(),I(t,0,e,s)),t):(lt(t,0,e,s)||(t=t.slice(),ht(t,0,e,s)),t)}(s.flatCoordinates,s.ends,r):s.flatCoordinates,s.ends?.flat(),r,t.properties||{},t.id).enableSimplifyTransformed(),!1,e)}function zt(t,e){if(!t)return null;if(Array.isArray(t)){const s=t.map((t=>zt(t,e)));return new Rt(s)}return Vt(new(0,qt[t.type])(t.flatCoordinates,t.layout,t.ends),!1,e)}class Ht extends Ut{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Zt(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Zt(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return at()}readFeaturesFromObject(t,e){return at()}readGeometry(t,e){return this.readGeometryFromObject(Zt(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return at()}readProjection(t){return this.readProjectionFromObject(Zt(t))}readProjectionFromObject(t){return at()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return at()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return at()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return at()}}function Zt(t){if("string"==typeof t){const e=JSON.parse(t);return e||null}return null!==t?t:null}class Wt extends Ht{constructor(t){t=t||{},super(),this.dataProjection=Q(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Q(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let s=null;s="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null};const i=$t(s.geometry);if(this.featureClass===ot)return Kt({geometry:i,id:s.id,properties:s.properties},e);const r=new Tt;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&s.geometry_name&&r.setGeometryName(s.geometry_name),r.setGeometry(zt(i,e)),"id"in s&&r.setId(s.id),s.properties&&r.setProperties(s.properties,!0),r}readFeaturesFromObject(t,e){let s=null;if("FeatureCollection"===t.type){s=[];const i=t.features;for(let t=0,r=i.length;t<r;++t){const r=this.readFeatureFromObject(i[t],e);r&&s.push(r)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return function(t,e){const s=$t(t);return zt(s,e)}(t,e)}readProjectionFromObject(t){const e=t.crs;let s;if(e)if("name"==e.type)s=Q(e.properties.name);else{if("EPSG"!==e.type)throw new Error("Unknown SRS type");s=Q("EPSG:"+e.properties.code)}else s=this.dataProjection;return s}writeFeatureObject(t,e){e=this.adaptOptions(e);const s={type:"Feature",geometry:null,properties:null},i=t.getId();if(void 0!==i&&(s.id=i),!t.hasProperties())return s;const r=t.getProperties(),n=t.getGeometry();return n&&(s.geometry=Jt(n,e),delete r[t.getGeometryName()]),dt(r)||(s.properties=r),s}writeFeaturesObject(t,e){e=this.adaptOptions(e);const s=[];for(let i=0,r=t.length;i<r;++i)s.push(this.writeFeatureObject(t[i],e));return{type:"FeatureCollection",features:s}}writeGeometryObject(t,e){return Jt(t,this.adaptOptions(e))}}function $t(t,e){if(!t)return null;let s;switch(t.type){case"Point":s=function(t){const e=t.coordinates;return{type:"Point",flatCoordinates:e,layout:ct(e.length)}}(t);break;case"LineString":s=function(t){const e=t.coordinates,s=e.flat();return{type:"LineString",flatCoordinates:s,ends:[s.length],layout:ct(e[0]?.length||2)}}(t);break;case"Polygon":s=function(t){const e=t.coordinates,s=[],i=e[0]?.[0]?.length,r=R(s,0,e,i);return{type:"Polygon",flatCoordinates:s,ends:r,layout:ct(i)}}(t);break;case"MultiPoint":s=function(t){const e=t.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:ct(e[0]?.length||2)}}(t);break;case"MultiLineString":s=function(t){const e=t.coordinates,s=e[0]?.[0]?.length||2,i=[],r=R(i,0,e,s);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:ct(s)}}(t);break;case"MultiPolygon":s=function(t){const e=t.coordinates,s=[],i=e[0]?.[0]?.[0].length||2,r=z(s,0,e,i);return{type:"MultiPolygon",flatCoordinates:s,ends:r,layout:ct(i)}}(t);break;case"GeometryCollection":s=function(t){const e=t.geometries.map((function(t){return $t(t)}));return e}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return s}function Jt(t,e){const s=(t=Vt(t,!0,e)).getType();let i;switch(s){case"Point":i=function(t){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case"LineString":i=function(t){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case"Polygon":i=function(t,e){let s;e&&(s=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(s)}}(t,e);break;case"MultiPoint":i=function(t){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case"MultiLineString":i=function(t){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case"MultiPolygon":i=function(t,e){let s;e&&(s=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(s)}}(t,e);break;case"GeometryCollection":i=function(t,e){e=Object.assign({},e),delete e.featureProjection;const s=t.getGeometriesArray().map((function(t){return Jt(t,e)}));return{type:"GeometryCollection",geometries:s}}(t,e);break;case"Circle":i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+s)}return i}function Qt({coordinates:s,predictData:i,currentTimeEntity:r,abnormalData:n,RuleAbnormalData:o,generateData:a,showPosition:l}){const h=t.useRef(null),d=t.useRef(null),[c,u]=t.useState(null);let g;const f=function(t,e){const s=e.closest(".ol-control")?void 0:c.forEachFeatureAtPixel(t,(function(t){return t}));s?(d.current.style.left=t[0]+"px",d.current.style.top=t[1]+"px",s!==g&&(d.current.style.visibility="visible",d.current.innerText=JSON.stringify(s.getProperties().details,null,2))):d.current.style.visibility="hidden",s?.getProperties().details||(d.current.style.visibility="hidden"),g=s},m=()=>{c&&(c.on("pointermove",(function(t){if(t.dragging)return d.current.style.visibility="hidden",void(g=void 0);const e=c.getEventPixel(t.originalEvent);f(e,t.originalEvent.target)})),c.on("click",(function(t){t.coordinate;f(t.pixel,t.originalEvent.target)})),c.getTargetElement().addEventListener("pointerleave",(function(){g=void 0,d.current.style.visibility="hidden"})))};t.useEffect((()=>{c||(()=>{const t=new ut({maxZoom:18,source:new Xt({url:"http://192.168.11.122:7578/geoserver/ggp/wms",params:{LAYERS:"ggp:ggp",TRANSPARENT:!0,exceptions:"application/vnd.ogc.se_inimage",VERSION:"1.1.1",FORMAT:"image/png",WIDTH:"Auto",HEIGHT:"Auto",transparent:!0}})}),e=new ut({title:"标注",source:new gt({})}),s=new ft({target:h.current,layers:[e,t],view:new mt({center:[120.212877,30.253187],zoom:9.5,projection:"EPSG:4326"})});let i=new yt({source:new pt});s.addLayer(i),u(s)})()}),[]);const y=t=>{let e=c.getLayers().getArray();for(let s=0;s<e.length;s++)e[s]?.className_.substring(0,t.length)==t&&c.removeLayer(e[s])},p=t=>{"normalTrack"==t&&(y("normalTrack"),y("predictTrack"),y("normalPoint"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single")),"predictTrack"==t&&(y("predictTrack"),y("normalPoint"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single")),"generaTrack"==t&&(y("predictTrack"),y("normalPoint"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single")),"normalPoint"==t&&(y("normalTrack"),y("predictTrack"),y("normalPoint"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single")),"abnormalPoint"==t&&(y("normalTrack"),y("predictTrack"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single")),"ruleAbnormalPoint"==t&&(y("normalTrack"),y("predictTrack"),y("abnormalPoint"),y("ruleAbnormalPoint"),y("generaTrack"),y("single"))},_=(t,e,s,i)=>{if(1==t.length){let r=new yt({source:new pt,className:s}),n=new x(t[0]),o=new _t({image:new Ct({radius:5,fill:new Pt({color:e})})}),a=new Tt({geometry:n,details:{name:i},style:o});a.setStyle(o),r.getSource().addFeature(a),c.addLayer(r),c.getView().setCenter(t[0]),m()}else{const r=(t,s)=>{let i=[],r=new _t({stroke:new vt({color:e,width:10})});i.push(r);let n=t.getGeometry();const o=n.getLength(),a=50*s,l=Math.floor(o/a),h=[],d=[0];n.forEachSegment((function(t,e){let s=e[0]-t[0],i=e[1]-t[1],r=Math.atan2(i,s);d.unshift(Math.sqrt(s**2+i**2)+d[0]),h.push(r)}));for(let e=1;e<l;++e){const t=n.getCoordinateAt(e/l),s=e*a,r=d.findIndex((t=>t<=s));i.push(new _t({geometry:new x(t),image:new wt({src:"/icon/arrow.png",opacity:.8,anchor:[.5,.5],rotateWithView:!1,rotation:-h[d.length-r-1],scale:.5})}))}return i};let n=new yt({source:new pt,className:s});c.addLayer(n);let o={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:t||[]}}]},a=new Wt({featureProjection:"EPSG:3857"}).readFeature(o.features[0],{featureProjection:c.getView().getProjection()});a.set("details",i),n.getSource().addFeature(a),a.setStyle(r),c.getView().fit(a.getGeometry(),{padding:[50,50,50,50],duration:500,maxZoom:14}),m()}},C=(t,e,s)=>{let i=t.filter((t=>"Virtual"!==t.name?.substring(0,7))),r=new yt({source:new pt,className:s}),n=[];for(let o=0;o<i?.length;o++){let t,s=new x([i[o].location.longitude,i[o].location.latitude]);t=e||(1==i[o].enemy?"red":"blue");let r=new _t({image:new wt({color:t,crossOrigin:"anonymous",src:i[o].category?`/icon/${i[o].category}.svg`:"/icon/Soldier.svg",scale:.15})}),a=new Tt({geometry:s,details:{...i[o]}});a.setStyle(r),n.push(a)}r.getSource().addFeatures(n),c.addLayer(r),c.getView().fit(n[0].getGeometry(),{padding:[20,20,20,20],duration:500,maxZoom:16}),m()},P=(t,e,s)=>{let i=[];for(let r=0;r<t.length;r++)i.push(t[r].coordinates);_(i,"blue",e,s)};t.useEffect((()=>{if(c&&s&&p("normalTrack"),c&&s?.length>0){p("normalTrack");for(let t=0;t<s.length;t++)P(s[t],`normalTrack${t}`,s[t][0].name)}}),[s]),t.useEffect((()=>{if(c&&null!==i&&p("predictTrack"),c&&i?.length>0){p("predictTrack");for(let t=0;t<i.length;t++)_(i[t],"red",`predictTrack${t}`,s[t][0].name)}}),[i]),t.useEffect((()=>{c&&null!==r&&p("normalPoint"),c&&r?.length>0&&(p("normalPoint"),C(r,null,"normalPoint"))}),[r]),t.useEffect((()=>{c&&null!==n&&p("abnormalPoint"),c&&n?.length>0&&(p("abnormalPoint"),C(n,"yellow","abnormalPoint"))}),[n]),t.useEffect((()=>{c&&null!==o&&p("ruleAbnormalPoint"),c&&o?.length>0&&(p("ruleAbnormalPoint"),C(o,"yellow","ruleAbnormalPoint"))}),[o]);t.useEffect((()=>{c&&null==l&&y("supervisePosition"),c&&l&&((t,e,s,i,r)=>{let n=new yt({source:new pt,className:s}),o=new x([t.wzlongitude,t.wzlatitude]),a=new _t({image:new wt({color:e,crossOrigin:"anonymous",src:`/icon/${i}.png`,scale:.15,anchor:[.5,1],rotateWithView:!1})}),l=new Tt({geometry:o,details:r});l.setStyle(a),n.getSource().addFeature(l),c.addLayer(n),setTimeout((()=>{c.getView().fit(l.getGeometry(),{padding:[20,20,20,20],duration:500,maxZoom:16})}),100),m()})(l,"red","supervisePosition","Orientation",{"监管类型":"位置监管",latitude:l.wzlatitude,longitude:l.wzlongitude,radius:l.radius})}),[l]);const w=(t,e,s,i)=>{let r=[];for(let n=0;n<t.length;n++)r.push([t[n].entity.location.longitude,t[n].entity.location.latitude]);_(r,"red",s,i),((t,e,s,i)=>{let r=new yt({source:new pt,className:s}),n=new x([t.location.longitude,t.location.latitude]),o=new _t({image:new wt({color:e,crossOrigin:"anonymous",src:`/icon/${i}.png`,scale:.6,anchor:[.5,1],rotateWithView:!1})}),a=new Tt({geometry:n,details:{"战略意图":t.policy,"战略布局点":t.location}});a.setStyle(o),r.getSource().addFeature(a),c.addLayer(r),m()})(t[t.length-1].entity,"red",`single${s}`,"End")};return t.useEffect((()=>{if(c&&null!==a&&p("generaTrack"),c&&a?.length>0){p("generaTrack");for(let t=0;t<a.length;t++)w(a[t],0,`generaTrack${t}`,a[t][0].entity.name)}}),[a]),e.jsx("div",{className:Ft,children:e.jsx("div",{ref:h,style:{width:"100%",height:"100%"},id:"mymap",className:"imap",children:e.jsx("div",{ref:d,className:"info"})})})}export{Qt as M};
